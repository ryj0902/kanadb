<!DOCTYPE html>
{% load static %}
{% load card_filters %}
{% load i18n %}
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{% static 'card/select_card.js' %}"></script>
    <script src="{% static 'card/search_card.js' %}"></script>
    <script src="{% static 'card/html2canvas.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'card/style.css' %}">
    <script>
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{ csrf_token }}' }
        });
    </script>
</head>
<body>
    {% include 'navbar.html' %}
    <div class="container">
        <div class="left">
            <button class="search-btn" id="btn-episode" onclick="openTab('episode')">{% trans "에피소드" %}</button>
            <button class="search-btn" id="btn-detail" class="passive" onclick="openTab('detail')">{% trans "상세" %}</button>
            <button class="search-btn" id="btn-etc" class="passive" onclick="openTab('etc')">{% trans "기타" %}</button>
            <form method='POST' id='search-form'>
                {% csrf_token %}
                <div class="search-filter" id="search-filter-episode">
                    <table>
                        <tr><td class="search-filter-title">{% trans "시즌 1" %} <input type="checkbox" id="toggle-all-episode-season1"> </td><td class="search-filter-contents">
                            {% for sublist in form.episode_season1|split_by_9 %}
                                {% for item in sublist %}
                                    {{ item }}
                                {% endfor %}
                                <br>
                            {% endfor %}
                            </td></tr>
                        <tr><td class="search-filter-title">{% trans "시즌 2" %} <input type="checkbox" id="toggle-all-episode-season2"> </td><td class="search-filter-contents">
                            {% for sublist in form.episode_season2|split_by_9 %}
                                {% for item in sublist %}
                                    {{ item }}
                                {% endfor %}
                                <br>
                            {% endfor %}
                        </td></tr>
                        <tr><td class="search-filter-title">{% trans "이벤트" %} <input type="checkbox" id="toggle-all-episode-event"> </td><td class="search-filter-contents">
                            {% for sublist in form.episode_event|split_by_9 %}
                                {% for item in sublist %}
                                    {{ item }}
                                {% endfor %}
                                <br>
                            {% endfor %}
                        </td></tr>
                        <tr><td class="search-filter-title">{{ form.search_type }}</td><td class="search-filter-contents">{{ form.search_text }} <button class="btn-submit" type="submit" name="tab" value="episode">{% trans "검색" %}</button></td></tr>
                    </table>
                </div>
                <div class="search-filter" id="search-filter-detail">
                    <table>
                        <tr><td class="search-filter-title">{% trans "종류" %} <input type="checkbox" id="toggle-all-category"> </td><td class="search-filter-contents">{{ form.category }}</td></tr>
                        <tr><td class="search-filter-title">{% trans "등급" %} <input type="checkbox" id="toggle-all-rarity"> </td><td class="search-filter-contents">{{ form.rarity }}</td></tr>
                        <tr><td class="search-filter-title">{% trans "소속" %} <input type="checkbox" id="toggle-all-theme"> </td><td class="search-filter-contents">{{ form.theme }}</td></tr>
                        <tr><td class="search-filter-title">{% trans "사이즈" %}</td><td class="search-filter-contents">{{ form.size_min }} {{ form.size_max }}</td></tr>
                        <tr><td class="search-filter-title">{{ form.search_type }}</td><td class="search-filter-contents">{{ form.search_text }} <button class="btn-submit" type="submit" name="tab" value="detail">{% trans "검색" %}</button></td></tr>    
                    </table>
                </div>
                <div class="search-filter" id="search-filter-etc">
                    <table>
                        <tr><td class="search-filter-title">{% trans "기타" %}</td><td class="search-filter-contents">{{ form.etc }}</td></tr>
                        <tr><td class="search-filter-title">{{ form.search_type }}</td><td class="search-filter-contents">{{ form.search_text }} <button class="btn-submit" type="submit" name="tab" value="etc">{% trans "검색" %}</button></td></tr>
                    </table>
                </div>
            </form>

            <div class="search-result">
                <div class="image-grid">
                    {% for card in card_list %}
                        {% trans "캐릭터" as character %}
                        {% trans "추종자" as follower %}
                        {% trans "스펠" as spell %}
                        <div class="image-grid-element{% if not card.producible %} unproducible-element{% endif %}" onclick="selectCard({{ card.id }}, 0)">
                            <div class="image-card" style="background-image: url({{ card.url }});"></div>
                            <div class="image-frame" style="background-image: url({{ card.frame }});"></div>
                            <div class="text-stat" id="card-size" {% if card.category ==  character %} style="display:none;" {% endif %}>{{ card.size }}</div>
                            <div class="text-stat" id="card-atk" {% if card.category != follower %} style="display:none;" {% endif %}>{{ card.atk }}</div>
                            <div class="text-stat" id="card-def" {% if card.category != follower %} style="display:none;" {% endif %}>{{ card.defs }}</div>
                            <div class="text-stat" id="card-hp" {% if card.category == spell %} style="display:none;" {% endif %}>{{ card.hp }}</div>
                        </div>
                    {% endfor %}
                </div>
                <div class="image-grid-page">
                </div>
            </div>

            <h3>{%trans "검색 불가 카드 리스트(임시)" %}</h3>
            <li>
                <a href="javascript:void(0);" onclick="selectCard(2100330, 0)">{% trans "탈렌티움 리스토어" %}</a>
            </li>

        </div>

        <div class="right">
            {% include 'card/select_card.html' %}
        </div>
    </div>
</body>
<script>
<!-- page in search result -->
    var page = {{ page }};
    var page_total = {{ page_total }};
    $('.image-grid-page').html(
        '<button id="page-down" onclick="updatePage(0)">&lt;</button>' +
            '<p class="page">' + page + ' / ' + page_total + '</p>'+
        '<button id="page-up" onclick="updatePage(1)">&gt;</button>'
    )
<!-- tab in search filter -->
    var tab = '{{ tab }}';
    openTab(tab);
    syncSearchFilter();

<!-- selected card variable -->
    var link_origin_id = 0;
    var link_card_ids = '';
    var link_card_idx = 0;
    var enhance_origin_id = 0;
    var enhance_card_prev = -1;
    var enhance_card_next = -1;
    var baseUrl = "{{ base_url_from_django_view_context }}";
    var lang = window.location.pathname.split("/")[1];
    const horizontalLayout = "{{ horizontal_layout }}";
    const verticalLayout = "{{ vertical_layout }}";

<!-- toggle all checkbox -->
    addToggleAllEventListener();

<!-- function call by hash in url -->
    window.onload = function() {
        const hash = window.location.hash.substring(1); // Remove the #
        const parts = hash.split('/');
        const functionName = parts[0];
        const arg1 = parts[1];
        const arg2 = parts[2];
        console.log(functionName, arg1, arg2);
        if (functionName && typeof window[functionName] === 'function') {
            console.log(functionName, arg1, arg2);
            window[functionName](arg1, arg2);
        }
    };

</script>
</html>